{
    "collab_server" : "",
    "contents" : "library(readxl)\nlibrary(lubridate)\nlibrary(magrittr)\nlibrary(geofacet)\nlibrary(extrafont)\nlibrary(tidyverse)\n\n#данные по регионам\nreg <- read_xlsx(\"crimes.xlsx\", sheet = 1, trim_ws = TRUE)\n\n\n#Госстат дает данные по количеству преступлений\n#в 2012 год с приметкой по 20.11.2012 включительно,\n#поэтому добавляем за ноябрь-декабрь 2012 (т.е. до конца года)\n#информацию по среднему кол-ву преступлений за день\ndays_of_monitoring <-\n  (ymd(\"2012-11-20\") - ymd(\"2012-01-01\")) / ddays(1)\n\nreg %<>% within(value_reg[year == 2012 &\n                            factor == \"crimes\"] <-\n                  #2012 - високосный год\n                  (364 * value_reg[year == 2012 &\n                                     factor == \"crimes\"]) / days_of_monitoring)\n\n\n#индекс преступности\nreg %<>%\n  spread(key = factor, value = value_reg) %>%\n  mutate(index_reg = crimes / population * 10)\n\n\n#определяем индекс по последнему году\n#для заливки geom_area\ncur <- reg %>% group_by(name) %>%\n  summarise(index_last = index_reg[year == max(year)])\n\nreg %<>% inner_join(cur, by = \"name\")\n\n\n#данные по Украине + корректировка за 2012 + рассчет индекса\navg <- read_xlsx(\"crimes.xlsx\", sheet = 2, trim_ws = TRUE)\n\navg %<>%\n  spread(key = factor, value = value_avg)\n\navg$crimes[avg$year == 2012] <-\n  (364 * avg$crimes[avg$year == 2012]) / days_of_monitoring\n\navg %<>% mutate(index_avg = crimes / population * 10)\n\n\n#custom grid by https://hafen.github.io/grid-designer/\nukraine <- data.frame(\n  name = as.character(\n    c(\n      \"Сумська\",\n      \"Чернігівська\",\n      \"Волинська\",\n      \"м. Київ\",\n      \"Київська\",\n      \"Житомирська\",\n      \"Рівненська\",\n      \"Полтавська\",\n      \"Харківська\",\n      \"Луганська\",\n      \"Львівська\",\n      \"Черкаська\",\n      \"Вінницька\",\n      \"Хмельницька\",\n      \"Тернопільська\",\n      \"Дніпропетровська\",\n      \"Кіровоградська\",\n      \"Донецька\",\n      \"Закарпатська\",\n      \"Івано-Франківська\",\n      \"Запорізька\",\n      \"Одеська\",\n      \"Миколаївська\",\n      \"Херсонська\",\n      \"Чернівецька\",\n      \"АР Крим\",\n      \"м. Севастополь\"\n    )\n  ),\n  row = c(1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 5, 5),\n  col = c(6, 5, 1, 4, 5, 3, 2, 6, 7, 8, 1, 5, 4, 3, 2, 7, 6, 8, 1, 2, 7, 4, 5, 6, 3, 6, 7),\n  code = c(1:27),\n  stringsAsFactors = FALSE\n)\n\n\npng(filename = \"crimes.png\",\n    width = 1200,\n    height = 950)\n\nggplot(data = reg, mapping = aes(x = year)) +\n  geom_line(data = avg,\n            mapping = aes(y = index_avg),\n            color = \"#7F8590\") +\n  geom_line(mapping = aes(y = index_reg),\n            size = 1,\n            color = \"#a50f15\") +\n  geom_area(mapping = aes(y = index_reg, fill = index_last),\n            alpha = 0.3) +\n  facet_geo( ~ name, grid = ukraine) +\n  scale_fill_gradient(low = \"#fee5d9\", high = \"#a50f15\") +\n  scale_x_continuous(breaks = seq(1995, 2016, 7),\n                     labels = c(\"'95\", \"'02\", \"'09\", \"'16\")) +\n  scale_color_manual(values = c(\"#7F8590\", \"#a50f15\"),\n                     labels = c(\"Україна\", \"регіон \")) +\n  labs(title = \"Рівень злочинності в Україні в 1995-2016 роках\",\n       subtitle = \"кількість правопорушень на 10 000 осіб по регіонам і середня по Україні\",\n       caption = \"За даними територіальних органів Держстату | Візуалізація: Голомб Володимир\") +\n  theme_minimal(base_family = \"PT Sans\") +\n  theme(\n    text = element_text(\n      family = \"PT Sans\",\n      face = \"plain\",\n      color = \"#3A3F4A\",\n      size = 30\n    ),\n    axis.title = element_blank(),\n    axis.text = element_text(size = rel(0.45)),\n    strip.text.x = element_text(size = rel(0.6)),\n    panel.spacing.x = unit(1.25, 'lines'),\n    panel.spacing.y = unit(1.50, 'lines'),\n    legend.position = \"none\",\n    panel.grid.major = element_line(\n      size = 0.3,\n      linetype = \"dotted\",\n      color = \"#A3A9B3\"\n    ),\n    panel.grid.minor = element_blank(),\n    plot.title = element_text(face = \"bold\",\n                              margin = margin(b = 10, t = 20)),\n    plot.subtitle = element_text(\n      size = rel(0.7),\n      face = 'plain',\n      margin = margin(b = 30)\n    ),\n    plot.caption = element_text(\n      size = rel(0.65),\n      margin = margin(b = 10, t = 50),\n      hjust = 0.5,\n      color = '#5D646F'\n    ),\n    plot.background = element_rect(fill = '#EFF2F4'),\n    plot.margin = unit(c(2, 2, 2, 2), 'cm')\n  )\n\ndev.off()\n",
    "created" : 1498847719383.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2013839419",
    "id" : "9B2121CE",
    "lastKnownWriteTime" : 1498997295,
    "last_content_update" : 1498997295958,
    "path" : "D:/OneDrive/crimes/geo_crimes.R",
    "project_path" : "geo_crimes.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}